I"ô<p>ì´ë²ˆì—ëŠ” <strong>Condition Variables</strong>ì— ëŒ€í•´ ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤.</p>

<h1 id="condition-variabelsë€-ë¬´ì—‡ì¼ê¹Œ">Condition Variabelsë€ ë¬´ì—‡ì¼ê¹Œ?</h1>

<p>â€™'â€™c
void *child(void *arg) {
    printf(â€œchild\nâ€);
    done = 1;
    return NULL;
}
â€¦
Pthread_create(&amp;c, NULL, child, NULL);
while (done == 0)
; // spin
â€˜â€™â€™</p>

<p>ìœ„ì˜ ì˜ˆì‹œì—ì„œëŠ” childê°€ í•´ì•¼í•  ì¼ì„ ë§ˆë¬´ë¦¬í•˜ë©´ doneì´ë¼ëŠ” ê³µìœ  ë³€ìˆ˜ë¡œ ì¢…ë£Œë¥¼ ì•Œë¦¬ê³  ìˆë‹¤. ì—¬ê¸°ì„œëŠ” ìš°ë¦¬ê°€ ì´ì „ì— lockì—ì„œ ê³µë¶€í–ˆë˜ spin ë°©ë²•ìœ¼ë¡œ ì´ ìŠ¤ë ˆë“œì˜ ì‹ í˜¸ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤. ê²°êµ­ ë¶€ëª¨ ìŠ¤ë ˆë“œ, ì¦‰ ì´ ìƒí™©ì—ì„œ ë©”ì¸ ìŠ¤ë ˆë“œëŠ” ì˜ë¯¸ ì—†ëŠ” ë°˜ë³µë¬¸(spin)ì„ ì‹¤í–‰ì‹œí‚¤ë©° ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ê²ƒì´ë‹¤. ì—„ì²­ë‚œ CPUì˜ ë‚­ë¹„ê°€ ì•„ë‹ ìˆ˜ ì—†ë‹¤!:triumph: Single-CPUë¼ë©´ ë‚­ë¹„ì˜ íš¨ê³¼ê°€ ë”ìš± ì²´ê°ë˜ì§€ ì•Šì„ ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ì´ spinì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ìŠ¤ë ˆë“œë¥¼ <code class="language-plaintext highlighter-rouge">Sleeping State</code> ì „í™˜í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” <code class="language-plaintext highlighter-rouge">Condition Variable</code>ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>

<p>Condition Variableì€ í•˜ë‚˜ì˜ ëª…ì‹œì ì¸ <code class="language-plaintext highlighter-rouge">Queue</code>ì´ë‹¤. <code class="language-plaintext highlighter-rouge">wait()</code> í•¨ìˆ˜ëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ ê¸°ë‹¤ë ¤ì•¼ í•  ìŠ¤ë ˆë“œê°€ Sleeping State, ì •í™•íˆëŠ” ìŠ¤ë ˆë“œë¥¼ Queueì— ë„£ëŠ”ë‹¤. â€˜signal()â€™ í•¨ìˆ˜ëŠ” wait()ìœ¼ë¡œ ê¸°ë‹¤ë¦¬ê³  ìˆëŠ” ìŠ¤ë ˆë“œì—ê²Œ ì‹ í˜¸ë¥¼ ì¤Œìœ¼ë¡œì¨ <code class="language-plaintext highlighter-rouge">Ready State</code>, ì¦‰ ìŠ¤ë ˆë“œë¥¼ ê¹¨ìš´ë‹¤. ì¼ë°˜ì ì¸ ì‚¬ìš©ë²•ì˜ ì˜ˆì‹œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">pthread_mutex_t</span> <span class="n">m</span> <span class="o">=</span> <span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>
    <span class="n">pthread_cond_t</span> <span class="n">c</span> <span class="o">=</span> <span class="n">PTHREAD_COND_INITIALIZER</span><span class="p">;</span>   

<span class="kt">void</span> <span class="nf">thr_exit</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span> 
    <span class="n">done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">Pthread_cond_signal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
    <span class="n">thread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">child</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">"child</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">thr_exit</span><span class="p">();</span>
   <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">thr_join</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">done</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">Pthread_cond_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
    <span class="n">Pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<span class="p">}</span>   

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"parent: begin</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">pthread_t</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">Pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">thr_join</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"parent: end</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

:ET